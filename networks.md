# Компьютерные сети

_Романишин Виктор Васильевич_

Concept Draw Office - Программа для рисования плана схемы сети.

Dia - Альтернативная программа для рисования.

**Все** компьютерные сетевые технологие используют одни и те же среды передачи данных. Различие лишь в способе получения к ним доступа (доминация/талоны).

Среды передачи данных:
- Медный кáбель
  - Носители информации: Электроны
  - Типы:
    - Коаксиальный кабель (медная коаксиальная жила в пластиковой оболочке, с экраном поверх в виде сетки #, благодаря чему шумы инвертируются). Важен диаметр изолятора, переменному току оказывается сопротивление.
      - Сейчас практически, не используется, в основном, в модемах
      - Плюсы:
        - Большая длина (до неск. Км) благодаря экрану
        - < частота тока => > длина
      - Минусы:
        - Малая скорость передачи данных (<= 10Мбт/с)
        - Однонаправленность (симплекс)
        - Высокая стоимость
    - Витая пара
      - `/\/\[.=====.]/\/\`, _где . - инвертор_. Присутствуют потери, но при инвертации на выходе помехи гасятся, а полезный сигнал удваивается.

      - Плюсы:
        - Самая низкая цена
        - Скорость передачи данных (100 Мбт/с+)
        - Двунаправленность
      - Минусы:
        - Длина секмента ограничена (<= 100 м) (можно попробовать и больше, но без гарантии) (для бóльшей дальности используются репитеры, которые перекодируют сигнал)
        - Не может обладать высокой скоростью передачи данных на одной жиле (поэтому их объединяют, но это бóльшие затраты)
      - Качество кабеля определяет его возможности
        - Категории качества
          - CAT-3 [Телефонный кабель] - Самая старая и дешёвая (<=10 Мб/с). Используется в модемах (они <= 2 Мбт/с).
          - CAT-5 - (<= 100 Мб/с)
            - 4-жильный (Домашний интернет)
            - 8-жильный (Сервера)
          - CAT-5E - (<= 1 Гб/с)
            - Чуть-чуть дороже CAT-5
            - 8-жил
            - Переключение жил в одну сторону, когда происходит скачивание/загрузка. (При одновременном использовании приёма/передачи)
          - CAT-6 - (1 Гбт/c)
          - CAT-7 - Имеет экран на каждую пару и на группу в целом. (Самый качественный) (<= 10 Гб/с)
      - Типы:
        - 4-жильная
          - Позволяет передавать информацию в обоих направлениях одновременно (пара на Tx (Transmit), пара на Rx (Recieve))
        - 8-жильная
          - Позволяет распараллеливать потоки по 2 в каждую сторону (и в прочих комбинациях), или все 4 в одну
- Оптоволокно
  - Носители информации: Фотоны

  - Плюсы:
    - Сверхвысокая дальность > 100 Км

  - Типы:
    - Однорежимное
    - Многорежимное
- Радиоволна
  - Носители информации: Электромагнитная волна

  - Технологии:
    - WIFI (< 3.5 Км)
    - Bluetooth (< 10 м)


## Аппаратная часть компьютерных сетей

> Топология - способ подключения компьютера к сети.

- Сетевая карта (NIC - Network Interface Controller)
- [||]===========[=]=========[||]
  - По бокам терминаторы
  - Устройства подключаются в разрыв кабеля
  - Подобно телевизионному подключению, но сопротивление переменному току 50 Ом, вместо 75/300 Ом в телевизорах
  - Называется **общая шина**
  - Топология: **Шина** - Сеть на основе коаксиального кабеля
    - Минусы:
      - Любая поломка выводит из строя всю сеть
- **Сетевой концентратор** (HUB) (Для первых хабов скорость 10 Мб/c)
  - HUB - не интеллектуальное устройство (не содержит управляющих частей и **не** управляет сетью). Он просто повторяет сигнал входа на все выходы.
  - Типы:
    - Активный - Содержат активную электронику (микросхемы, повторяющие сигнал).
      - Плюсы:
        - Можно использовать в режиме повторителя для увеличения фрагмента сети
        - Не изменяют уровень сигнала
        - Позволяет использовать кабель с максимальной длиной
      - Минусы:
        - Дороже пассивного
    - Пассивный - Собираются на резисторах и не имеют электропитания. Усредняет токи при соединении нескольких компьютеров, внося изменения и уменьшая уровень сигнала.
      - Плюсы:
        - Низкая стоимость
      - Минусы:
        - Уменьшают длину кабеля
        - Уменьшают уровень сигнала
  - Топология: **Звезда** - Сеть на основе витой пары (хаб в центре)
    - Возможно объеденить _звезду_ и _шину_
  - Минусы:
    - Зашумление сети (все получают всю информацию)
- **Сетевой комутатор** (Switch) - Сложное и серьёзное устройство. Используются с 4-х и 8-ми жильной **витой парой**, но может использовать **оптоволокно**.
  - Интеллектуальное устройство
  - Содержит сетевые адаптеры по количеству входов
  - Маленькая сетевая карточка (процессор, память, т.п.)
  - Соединяет только абонентов, ведующих сеанс связи в данный момент. Остальные абоненты эту информацию не получают. (Содержит таблицу подключённых устройств)
    - Первый пакет разбрасывается на все выходы и Switch ожидает, какой компьютер на него откликнется, внося его в таблицу
    - Все последующие пакеты, содержащие этих же участников будут адресоваться исключительно между ними
  - Значительно разгружает сеть от ненужного трафика, **значительно увеличивая количество абонентов** и увеличивая общую пропускную способность сети
  - Передача данных пакетами, каждый пакет упаковывается в **окно (frame)**, который имеет **время жизни** (~30ms), поэтому пакет должен успеть добраться до цели.
    - Потом наступает тишина, которая означает скорое открытие окна.
  - **Каждый switch вносит временную задержку в канал связи** и должен продливать таймер.
  - **Правило 4-х switch'ей**: При соединении более 4-х switch'ей, сеть не сможет передать информацию дальше.
  - Топология: **любая**
- **Сетевой маршрутизатор** (Router)
  - **Программное устройство** (софт)
  - Работает на уровне пакетов (адресов)
  - Необходим для **объеденения сетей**, а не комьютеров
  - Имеет 2+ сетевые карты, каждая со своим адресом (2, 4, 8, 18 сетей)
  - Может быть шлюзом
- **Сетевой мост** (Bridge) - Объединяет разнотипные сети с разными сетевыми технологиями и средами передачи данных
  - Как и любоая точка доступа, **не имеет собственного адреса**
- **Сетевой повторитель** (Repeater) - Удлиняет сеть, повторяя сигнал
- Гибридные устройства:
  - WAN <-> WLAN: Bridge + Switch
  - WAN + WAN: Switch + Router
  - Домашний роутер: Bridge + WAN + LAN + Switch + Router

Существуют 2 базовых способа получения доступа к среде передачи данных:
- Конкуретный (Вероятностный) - Не гарантирует передачу данных [Самоорганизованная]
  - Сначала, первым компьютером в сети генерируется несущая частота фреймами (порциями по ~38мс, окружёнными тишиной)
  - Потом частота модулируется данными
  - В таких сетях, особенно, если **шина**, или **звезда с хабом**, пропускная способность очень зависит от количества компьютеров (норм. <= 20 узлов, 40 узлов - скорость просидает на 80%, 80 узлов - падает)
  - > CSMA/CD *(Carrier Sense Multiple Access with Collision Detection)* - Множественный доступ с прослушиванием несущей и обнаружением коллизий
  - Наличие свитча в подобных сетях позволяет значительно увеличить пропускную способность, уменьшить количество колизии и увеличить количество узлов
  - Все компьютеры, объединённые в единый сегмент называются **домен коллизии**
  - Для улучшения функционирования, большой домен коллизии разбивается на несколько мелких (подсетей)
  - Для объединения мелких сегментов необходимы роутеры
- Гарантированный (Определённый/Детерминированный) - Вариант с расподелением прав доступа к среде
  - Маркер - Передача маркера от одного компьютера к другому (в большинстве случаев, **кольцо**, но может быть и **шина**) [IBM]
    - Контейнер для информации
    - Передаётся по кругу от одного компьютера к другому, в одном направлении
    - Генерируется первым компьютером
    - Передача гарантирована
    - Время передачи информации известен
  - Приоритет - Доступ на основе приоритетов [100VG ANYLAN]  [802.12]
    - Интеллектуальные хабы **MAU** выдают маркеры на основе приоритетов
    - Иерархическая сеть
    - Главный MAU генерирует пакет, согласно приоритетам ветки
    - Сервера, в основном, находятся в верхней ветке
    - Высокая скорость (100 Мб/c) [Звезда] и (50 Мб/с) [Кольцо]
    - Способствовало продолжению жизни кольца
    - Колько на основе MAU напоминает звезду, но является кольцом


Сетевые технологии:
- Ethernet (**L**ocal **A**rea **N**etwork)
  1. Ethernet (10 Мб/c, шина) [HUB]
  2. Fast Ethernet (100 Мб/c, звезда) [Switch]
  3. Gigabit Ethernet (1000 Мб/c, звезда) [Switch]


Существует ещё одна топология — **Mesh** (**Ячейка**)
  - Каждый соединён с каждым
  - Самая защищённая от падения
  - Необходимо большое количество сетевых адаптеров
  - В основном, используется в data-центрах
И **смешанные** топологии
  - Token Ling - MAU + Кольцо
  - FDDI - MAU + Двойное кольцо
  - Fibr Channel - MAU + Звезда


## Идеальная модель сетевого соединения OSI (7 ур.)

Координирует:
- Взаимодействие прикладных процессов
- Форма представления данных
- Единый способ хранения данных (буферы, кеши)
- Управление сетевыми ресурсами
- Безопасность и защита информации
- Диагностика программ и технических средств

7. Прикладной (OS, Soft)
  - Real: MS TCP/IP
  - Интерфейсы доступа к сетевым службам
6. Представление (обеспечивает однотипность данных) - Превращает данные в общий формат
5. Сеансовый (устанавливает связь между удалёнными процессами)
4. Транспортный (обеспечивает передачу и подтверждение передачи данных) [TCP/UDP]
3. Сетевой (адресация) [IP]
  - Маршруты
  - Преобразование логических адресов и имёна [DNS]
2. Канальный (Hard)
  1. Контроль логической связи LLC (*Logical Link Contol?*) - Формирует кадр, который можно поместить во фрейм
  2. Доступ к среде MAC (выбор сетевой карты)
1. Физический (протокол побитовой передачи данных) [Ethernet, ...]

MS TCP/IP:
- 7, 6, 5.5: Сокеты Windows | NetBIOS (старый, служит для обнаружения устройства в сети)
- 5.5: Interface TDI - Транспортный интерфейс для поддержания сеанса связи (виртуальный драйвер устройства)
- 4:
  - TCP:443
  - UDP
- 3:
  - ARP (Address Research Protocol)
    - IP адрес получателя
  - RARP (Reverse -)
    - IP адрес отправителя
  - ICMP
    - Протокол управляющих сообщений
  - IGMP (Internet Group Message Protocol)
    - Управляет группами
  - Interface NDIS
- 2, 1:
  - Драйверы сетевых карт NIC (Network Interface Controller)
  - Сетевые карты
  - PPP: Point-To-Point-Protocol - Восстанавливают канал связи
    - PPTP
  - Сетевые технологии

Сетевые технологии
- Технологии локальных сетей
  - Ethernet (Случайный доступ к кабелю - CSMA/CD)
  - Token Ring (Кольцо с маркером - Детерминированный)
  - Token Bus (Шина с маркером - Детерминированный)
  - FDDI (Кольцо с маркером - Детерминированный)
    - 100 Мб/с
    - Оптоволокно
    - Двойное кольцо
  - 100VGAnyLAN (Звезда с возможностью получения дерева до 5 хабов, с приоритетом) 802.12
  - ARCnet
    - Шина или звезда
    - 1977 год
    - 2.5 Мб/с
    - Всё построено на хабах
    - Используются активные концентраторы
    - Детерминированный доступ с маркером
  - Fibre Channel
    - Оптоволокно (Fibre)
    - Детерменированный доступ с маркером
- Технологии глобальных сетей
  - xDSL (Через телефонную сеть)
  - ISDN
  - X.25
  - Frame Relay
  - ATM

## Ethernet

- 10BaseT (Шина/Звезда)
- **100BaseT** (Звезда)
- 1000BaseT (Звезда, гибриды)
- 1GBBaseT

- 802.1
- 802.2
- 802.3 - MAC адреса (100 Мб/с)

Для уменьшения домена коллизии, он разбивается на подсети.

## IP пространства

Идентификация компьютера в сети

- Имя
  - Уникальное
  - Не должно содержать
    - Кириллицу
    - Пробелы
    - \_
    - Большие буквы
    - <= 12 символов (8 имя + 1 точка + 3 расширение)
    - Цифру в начале
- Объединение в логические группы (WORKGROUP) (Windows only)
  - В качестве имени может содержать только цифры
  - Все компьютеры, входящие в одну группу имеют одно название группы
  - Группа похожа на папку
  - Входя в Windows сеть, мы видим группы, внутри которых расположены узлы
  - Названия групп:
  - Home Edition: MSHOME
  - Pro, Ent, Ult: WORKGROUP

- IPv4: 32bit (4 * 8) address
- IPv6: 128bit

В сети 16 млн.

Изначально, IPv4 адрес не поддерживает иерархии.
Для формирования многоуровневой иерархической структуры сети необходимо создание разделения адреса и поделить на группы (подсети). Разделили адрес на 4 байта с помощью точек.

> w.x.y.z

Было решено использовать начальные биты в качестве обозначения группы

Классы
- A - 0 (126 сетей по 16 777 214 хостов) /8
  - w - сеть
  - x - компьютер
  - w e [1, 126]
  - Примеры:
    - 5.0.0.0
    - 127.0.0.1 - Зарезервированный адрес loopback/localhost
    - 10.0.0.0 - Серый адрес в классе A
- B - 10 (16384 (2¹³ сетеи по 2^16 - 2 хостов) /16
  - w.x - сеть
    - Обычно, x - сеть
  - y.z - компьютер
  - w e [128, 191.255.0.0]
  - Примеры:
    - 172.16.y.z-172.31.y.z - Серые адреса (16 сетей по 65 тыс хостов)
- C - 110 (2 097 150 2^21 сетей и 2^8-2 хостов) /24
  - w.x.y - сеть
    - w.x - класс
    - y - сеть
  - z - компьютер
  - w e [192, 223.255.255.0]
  - Примеры:
    - 192.168.y.z - Серые адреса (256 сетей по 254 хоста)
      - Класс
      - Класс
      - Сеть
      - Хост
- D - 1110 - мультимедиа (не используется)
- E - 11110


> z == 0 - обращение ко всей сети

> w.255.255.255 - broadcast, обрабатывают все

> Порт роутера выполняет функцию шлюза для объединения нескольких сетей

Белые адреса (внешние адреса) WAN
Серые адреса (внутренние адреса) LAN
  - Не принимаются к роутингу во внешних сетях.

### Безклассовая адресация (Маски)

Все современные сети используют маски.

Маски и классы полностью совместимы на программном уровне.

> Маска отсекает сеть от хостов (разделяет адрес на зону сети и зону хостов). Представляет из себя 4 8-битных бинарных числа.

Совмещение масок и классов существуют только в серых адресах.

/число - указывает на количество единиц в маске

Маска **всегда** начинается с единиц и заканчивается нулями. Перемешивание невозможно.

Для получения адреса сети, маска & адрес. Для адреса компьютера, маска инвертируется.

На подсети можно расходовать **только биты хостов**.

```
192.168.5.0/27
27-24 = 3 бита/подсети (2**3 = 8 сетей)

Есть 2 роутера x 4 порта + соединение между собой

1. .  0:   1 -  30,  31 - broadcast
2. . 32:  33 -  62,  63 - broadcast
3. . 64:  65 -  94,  95 - broadcast
4. . 96:  97 - 126, 127 - broadcast
5. .128: 129 - 158, 159 - broadcast
6. .160: 161 - 190, 191 - broadcast
7. .192: 193 - 222, 223 - broadcast
8. .224: 225 - 254, 255 - broadcast

/27: 255.255.255.224


172.xxx.0.0/16, 64 сеть
2**6 = 64
6 бит на обозначение подсети
=> /22 (16 + 6)

Бъём третий октет

Получить 34 сеть
1024 (хоста 1022+2) * 34 - 1024
256 / 64 = 4 - адреса в каждой сети

34 * 4 - 4

C: 192.168.4.0/24
```

- A x14 /28 (14)
- B x28 /27
- C x2 /30 (2)
- D x7 /28
- E x28

B -> E -> A -> D -> C

B: 0/27
E: 32/27
A: 64/28
D: 80/28
C: 96/30
100-255
```

Сначала раскидываются больш**и**е сети, а потом маленькие

## IP маршрутизация

- Адрес назначения
- Адрес соседнего маршрутизатора, от которого можно узнать о доступных сетях

Количество шагов (hops) от одной сети до другой называется **метрика**.

5. Должен иметь методы обслуживания и проверки информации о маршрутах
  1. Ручками

Варианты маршрутов:
- 

Глобальные сети:
- xDSL
- ARCnet
- Frame
- X.15

Fast Ethernet:
- Оптоволокно
- Витая пара Category 5
- Витая пара Category 5E

Локальная WiFi сеть:
- Switch
- Bridge


```
IP Route 0.0.0.0 0.0.0.0 192.168.100.2 - Шлюз последней надежды
           IP     Mask    Destination
```

При наличии 2+ сете, default шлюз будет работать некорректно.

## Шутки от Романишина

- Без роутеру вода не святиться
